# Dovecot configuration file

# Protocols enabled
protocols = imaps pop3s sieve

# Listen for connections
listen = *

# SSL/TLS settings
ssl = yes
ssl_cert = </etc/ssl/certs/dovecot.pem
ssl_key = </etc/ssl/private/dovecot.key

# Authentication settings
auth_mechanisms = plain login
disable_plaintext_auth = yes
auth_username_format = %n

# Mailbox settings
mail_location = maildir:~/Maildir
namespace inbox {
  inbox = yes
  mailbox Drafts {
    special_use = \Drafts
  }
  mailbox Junk {
    special_use = \Junk
  }
  mailbox Trash {
    special_use = \Trash
  }
  mailbox Sent {
    special_use = \Sent
  }
  mailbox "Sent Messages" {
    special_use = \Sent
  }
  mailbox Archives {
    special_use = \Archive
  }
}

# Logging
log_path = /var/log/dovecot.log
info_log_path = /var/log/dovecot-info.log
debug_log_path = /var/log/dovecot-debug.log

# Postfix integration (SASL)
postmaster_address = postmaster@{{ tech_domain.name }}
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}

# Sieve (mail filtering)
sieve_default_script_name = Open-Xchange
sieve_dir = ~/sieve

# SQL database for user authentication
# Included from 10-auth.conf.j2
!include conf.d/10-auth.conf

# Mail settings
!include conf.d/10-mail.conf

# Master user settings
!include conf.d/10-master.conf

# SSL settings
!include conf.d/10-ssl.conf

# Quota settings (if needed)
# plugin {
#   quota = maildir:Quota
#   quota_rule = *:storage=1G
# }
